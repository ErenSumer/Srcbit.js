<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SourceBit Server Status</title>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background-color: #f0f4f8;
        margin: 0;
        padding: 20px;
        color: #333;
      }
      .container {
        max-width: 1000px;
        margin: 0 auto;
        background-color: #ffffff;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 20px;
      }
      h1 {
        color: #2c3e50;
        text-align: center;
        margin-bottom: 30px;
      }
      .abstract-art {
        width: 100%;
        height: 200px;
        margin-bottom: 20px;
        background-size: cover;
        background-position: center;
        border-radius: 8px;
        cursor: pointer;
      }
      .route-group {
        margin-bottom: 20px;
        border: 1px solid #e0e0e0;
        border-radius: 4px;
        overflow: hidden;
        transition: all 0.3s ease;
      }
      .route-header {
        padding: 15px;
        background-color: #3498db;
        color: #ffffff;
        cursor: pointer;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .route-content {
        display: none;
        padding: 0;
        background-color: #f9f9f9;
      }
      .request-card {
        padding: 15px;
        border-bottom: 1px solid #e0e0e0;
        transition: background-color 0.3s ease;
      }
      .request-card:last-child {
        border-bottom: none;
      }
      .request-card:hover {
        background-color: #f0f0f0;
      }
      .method {
        font-weight: bold;
        padding: 3px 6px;
        border-radius: 3px;
        font-size: 0.9em;
      }
      .get {
        background-color: #2ecc71;
        color: #fff;
      }
      .post {
        background-color: #3498db;
        color: #fff;
      }
      .put,
      .patch {
        background-color: #f39c12;
        color: #fff;
      }
      .delete {
        background-color: #e74c3c;
        color: #fff;
      }
      details summary {
        cursor: pointer;
        color: #3498db;
      }
      pre {
        background-color: #f0f0f0;
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
      }
      .abstract-art {
        width: 100%;
        height: 200px;
        margin-bottom: 20px;
        background-size: cover;
        background-position: center;
        border-radius: 8px;
      }
    </style>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  </head>
  <body>
    <div class="container">
      <img src="" alt="Abstract" class="abstract-art" />
      <h1>SourceBit Logs</h1>
      <div id="routeGroups"></div>
    </div>

    <script>
      AOS.init();

      function updateStatus() {
        fetch("/log-data")
          .then((response) => response.json())
          .then((data) => {
            const routeGroupsHtml = Object.entries(data)
              .map(
                ([route, requests], index) => `
              <div class="route-group" data-aos="fade-up" data-aos-delay="${
                index * 100
              }">
                <div class="route-header" onclick="toggleRouteContent(this)">
                  <span>${route}</span>
                  <span>${requests.length} requests</span>
                </div>
                <div class="route-content">
                  ${requests
                    .map(
                      (req) => `
                      <div class="request-card" data-aos="fade-right">
                        <span class="method ${req.method.toLowerCase()}">${
                        req.method
                      }</span>
                        <strong>${req.path}</strong><br>
                        <small>Time: ${new Date(
                          req.time
                        ).toLocaleString()}</small><br>
                        <small>Status: ${req.responseStatus}</small><br>
                        <details>
                          <summary>Query Parameters</summary>
                          <pre>${JSON.stringify(req.query, null, 2)}</pre>
                        </details>
                      </div>
                    `
                    )
                    .join("")}
                </div>
              </div>
            `
              )
              .join("");
            document.getElementById("routeGroups").innerHTML = routeGroupsHtml;
            AOS.refresh();
          });
      }

      function toggleRouteContent(header) {
        const content = header.nextElementSibling;
        content.style.display =
          content.style.display === "none" ? "block" : "none";
        AOS.refresh();
      }

      setInterval(updateStatus, 5000);
      updateStatus();
    </script>
  </body>
</html>
